<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企业业务流程管理系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<!-- 账号管理模态框 -->
<div class="modal" id="userManagementModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-cog"></i> 账号管理</h2>
            <button class="modal-close" onclick="closeModal('userManagementModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="user-management-actions">
                <button class="btn-primary" onclick="showAddUserForm()">
                    <i class="fas fa-user-plus"></i> 添加新账号
                </button>
                <button class="btn-secondary" onclick="exportUsers()">
                    <i class="fas fa-download"></i> 导出账号列表
                </button>
            </div>
            
            <!-- 用户列表 -->
            <div class="user-list-section">
                <h3><i class="fas fa-users"></i> 现有账号</h3>
                <div class="user-table-container">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>用户名</th>
                                <th>角色</th>
                                <th>部门</th>
                                <th>姓名</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="userList">
                            <!-- 用户列表会动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 添加用户表单（默认隐藏） -->
            <div class="add-user-form" id="addUserForm" style="display: none;">
                <h3><i class="fas fa-user-plus"></i> 添加新用户</h3>
                <form id="addUserFormElement" onsubmit="return addNewUser(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="newUsername"><i class="fas fa-user"></i> 用户名 *</label>
                            <input type="text" id="newUsername" required placeholder="英文或拼音">
                        </div>
                        
                        <div class="form-group">
                            <label for="newUserRole"><i class="fas fa-user-tag"></i> 角色 *</label>
                            <select id="newUserRole" required>
                                <option value="">选择角色</option>
                                <option value="admin">管理员</option>
                                <option value="manager">部门经理</option>
                                <option value="hr">人事专员</option>
                                <option value="finance">财务人员</option>
                                <option value="employee">普通员工</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="newUserDepartment"><i class="fas fa-building"></i> 部门 *</label>
                            <select id="newUserDepartment" required>
                                <option value="">选择部门</option>
                                <option value="管理部">管理部</option>
                                <option value="人力资源部">人力资源部</option>
                                <option value="财务部">财务部</option>
                                <option value="技术部">技术部</option>
                                <option value="销售部">销售部</option>
                                <option value="行政部">行政部</option>
                                <option value="运营部">运营部</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="newUserName"><i class="fas fa-id-card"></i> 显示姓名 *</label>
                            <input type="text" id="newUserName" required placeholder="中文姓名">
                        </div>
                        
                        <div class="form-group">
                            <label for="newUserPassword"><i class="fas fa-key"></i> 初始密码 *</label>
                            <input type="password" id="newUserPassword" value="123456" required>
                            <small>默认密码：123456，建议用户首次登录后修改</small>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="newUserEmail"><i class="fas fa-envelope"></i> 邮箱（可选）</label>
                            <input type="email" id="newUserEmail" placeholder="用户邮箱">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> 创建账号
                        </button>
                        <button type="button" class="btn-secondary" onclick="hideAddUserForm()">
                            取消
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- 修改密码表单（默认隐藏） -->
            <div class="change-password-form" id="changePasswordForm" style="display: none;">
                <h3><i class="fas fa-key"></i> 修改密码</h3>
                <form id="changePasswordFormElement" onsubmit="return changeUserPassword(event)">
                    <input type="hidden" id="targetUserId">
                    
                    <div class="form-group">
                        <label for="currentPassword"><i class="fas fa-lock"></i> 当前密码</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword"><i class="fas fa-lock"></i> 新密码 *</label>
                        <input type="password" id="newPassword" required minlength="6" 
                               placeholder="至少6位字符">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword"><i class="fas fa-lock"></i> 确认新密码 *</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    
                    <div class="password-rules">
                        <p><i class="fas fa-info-circle"></i> 密码要求：</p>
                        <ul>
                            <li>至少6位字符</li>
                            <li>建议包含字母和数字</li>
                            <li>区分大小写</li>
                        </ul>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-key"></i> 修改密码
                        </button>
                        <button type="button" class="btn-secondary" onclick="hideChangePasswordForm()">
                            取消
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 确认删除模态框 -->
<div class="modal" id="confirmDeleteModal">
    <div class="modal-content small">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> 确认删除</h2>
            <button class="modal-close" onclick="closeModal('confirmDeleteModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p id="deleteConfirmText">确定要删除这个账号吗？此操作不可恢复。</p>
            <input type="hidden" id="userToDeleteId">
        </div>
        <div class="modal-footer">
            <button class="btn-danger" onclick="confirmDeleteUser()">
                <i class="fas fa-trash"></i> 确认删除
            </button>
            <button class="btn-secondary" onclick="closeModal('confirmDeleteModal')">
                取消
            </button>
        </div>
    </div>
</div>
    
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="page active">
        <div class="login-wrapper">
            <div class="login-card">
                <div class="brand-header">
                    <i class="fas fa-project-diagram"></i>
                    <h1>业务流程管理系统</h1>
                    <p class="subtitle">规范流程 · 提升效率 · 权限可控</p>
                </div>
                
                <div class="role-selector">
                    <h3><i class="fas fa-user-circle"></i> 请选择您的角色</h3>
                    <div class="role-grid">
                        <div class="role-card" data-role="admin" onclick="selectRole('admin')">
                            <div class="role-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <h4>系统管理员</h4>
                            <p>管理所有流程和用户</p>
                            <div class="role-badges">
                                <span class="badge">全权限</span>
                            </div>
                        </div>
                        
                        <div class="role-card" data-role="manager" onclick="selectRole('manager')">
                            <div class="role-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <h4>部门经理</h4>
                            <p>管理部门流程和审批</p>
                            <div class="role-badges">
                                <span class="badge">管理</span>
                                <span class="badge">审批</span>
                            </div>
                        </div>
                        
                        <div class="role-card" data-role="hr" onclick="selectRole('hr')">
                            <div class="role-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h4>人事专员</h4>
                            <p>负责人事行政流程</p>
                            <div class="role-badges">
                                <span class="badge">人事</span>
                                <span class="badge">行政</span>
                            </div>
                        </div>
                        
                        <div class="role-card" data-role="finance" onclick="selectRole('finance')">
                            <div class="role-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h4>财务人员</h4>
                            <p>负责财务相关流程</p>
                            <div class="role-badges">
                                <span class="badge">财务</span>
                                <span class="badge">报销</span>
                            </div>
                        </div>
                        
                        <div class="role-card" data-role="employee" onclick="selectRole('employee')">
                            <div class="role-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <h4>普通员工</h4>
                            <p>查看和执行业务流程</p>
                            <div class="role-badges">
                                <span class="badge">查看</span>
                                <span class="badge">执行</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="password-section">
                        <label for="password"><i class="fas fa-key"></i> 输入密码 (测试用: 123456)</label>
                        <input type="password" id="password" placeholder="请输入密码">
                        <button class="btn-login" onclick="login()">
                            <i class="fas fa-sign-in-alt"></i> 进入系统
                        </button>
                    </div>
                    
                    <div class="test-info">
                        <p><i class="fas fa-info-circle"></i> 测试说明：选择角色后输入任意密码即可进入</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 主系统页面 -->
    <div id="mainPage" class="page">
        <!-- 顶部导航 -->
        <header class="main-header">
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-project-diagram"></i>
                    <span>业务流程系统</span>
                </div>
                
                <!-- 全局搜索 -->
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="globalSearch" placeholder="搜索业务流程..." onkeyup="searchProcesses()">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-details">
                        <span class="user-name" id="userName">管理员</span>
                        <span class="user-role" id="userRole">系统管理员</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> 退出
                </button>
            </div>
        </header>
        
        <div class="main-container">
            <!-- 侧边栏菜单 -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-folder-open"></i> 流程分类</h3>
                    <button class="btn-collapse" onclick="collapseAllCategories()">
                        <i class="fas fa-compress-alt"></i> 全部折叠
                    </button>
                </div>
                
                <nav class="category-menu" id="categoryMenu">
                    <!-- 分类菜单会通过JS动态生成 -->
                </nav>
                
                <!-- 权限过滤 -->
                <div class="filter-section">
                    <h3><i class="fas fa-filter"></i> 权限过滤</h3>
                    <div class="filter-options" id="roleFilters">
                        <!-- 角色过滤选项会动态生成 -->
                    </div>
                </div>
                
                <!-- 统计信息 -->
                <div class="stats-section">
                    <h3><i class="fas fa-chart-bar"></i> 统计</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="totalProcesses">0</span>
                            <span class="stat-label">总流程数</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="visibleProcesses">0</span>
                            <span class="stat-label">可见流程</span>
                        </div>
                    </div>
                </div>
                
                <!-- 管理员专属功能 -->
                <div class="sidebar-section admin-only" id="adminPanel">
                    <h3><i class="fas fa-cog"></i> 管理功能</h3>
                    <button class="btn-admin" onclick="showAddProcessModal()">
                        <i class="fas fa-plus"></i> 添加流程
                    </button>
                    <button class="btn-admin" onclick="showUserManagement()">
                        <i class="fas fa-user-cog"></i> 账号管理
                    </button>
                    <button class="btn-admin" onclick="exportProcesses()">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                </div>
            </aside>
            
            <!-- 主内容区 -->
            <main class="content">
                <div class="content-header">
                    <div class="breadcrumb">
                        <span id="breadcrumb">所有业务流程</span>
                    </div>
                    <div class="content-actions">
                        <button class="btn-action" onclick="toggleViewMode()" id="viewToggle">
                            <i class="fas fa-th-list"></i> 列表视图
                        </button>
                        <button class="btn-action" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                    </div>
                </div>
                
                <!-- 流程列表/网格 -->
                <div class="process-container" id="processContainer">
                    <!-- 流程卡片会动态加载到这里 -->
                    <div class="loading" id="loading">
                        <i class="fas fa-spinner fa-spin"></i> 加载中...
                    </div>
                </div>
                
                <!-- 空状态 -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>暂无业务流程</h3>
                    <p>当前分类下没有流程，或您没有查看权限</p>
                    <button class="btn-primary" onclick="showAddProcessModal()" id="addFirstProcessBtn">
                        <i class="fas fa-plus"></i> 添加第一个流程
                    </button>
                </div>
            </main>
        </div>
        
        <!-- 添加流程模态框 -->
        <div class="modal" id="addProcessModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-plus-circle"></i> 添加新业务流程</h2>
                    <button class="modal-close" onclick="closeModal('addProcessModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addProcessForm" onsubmit="return addNewProcess(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="processTitle"><i class="fas fa-heading"></i> 流程名称 *</label>
                                <input type="text" id="processTitle" required placeholder="例如：新员工入职流程">
                            </div>
                            
                            <div class="form-group">
                                <label for="processCategory"><i class="fas fa-folder"></i> 流程分类 *</label>
                                <select id="processCategory" required>
                                    <option value="">选择分类</option>
                                    <option value="hr">人事行政</option>
                                    <option value="finance">财务管理</option>
                                    <option value="sales">销售业务</option>
                                    <option value="tech">技术研发</option>
                                    <option value="operation">运营管理</option>
                                    <option value="other">其他</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="processDepartment"><i class="fas fa-building"></i> 责任部门 *</label>
                                <select id="processDepartment" required>
                                    <option value="">选择部门</option>
                                    <option value="hr">人力资源部</option>
                                    <option value="finance">财务部</option>
                                    <option value="sales">销售部</option>
                                    <option value="tech">技术部</option>
                                    <option value="admin">行政部</option>
                                    <option value="operation">运营部</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label><i class="fas fa-users"></i> 可见角色权限 *</label>
                                <div class="checkbox-group" id="permissionCheckboxes">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="roles" value="admin" checked>
                                        <span>管理员</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="roles" value="manager">
                                        <span>部门经理</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="roles" value="hr">
                                        <span>人事专员</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="roles" value="finance">
                                        <span>财务人员</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="roles" value="employee" checked>
                                        <span>普通员工</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="processDescription"><i class="fas fa-align-left"></i> 流程描述</label>
                                <textarea id="processDescription" rows="3" placeholder="简要描述此流程的目的和适用范围"></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="processSteps"><i class="fas fa-list-ol"></i> 流程步骤 *</label>
                                <div class="steps-editor">
                                    <div class="steps-container" id="stepsContainer">
                                        <div class="step-item">
                                            <div class="step-header">
                                                <span class="step-number">1</span>
                                                <input type="text" class="step-title" placeholder="步骤标题">
                                                <button type="button" class="btn-step-remove" onclick="removeStep(this)">&times;</button>
                                            </div>
                                            <textarea class="step-details" placeholder="步骤详细说明..."></textarea>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-add-step" onclick="addStep()">
                                        <i class="fas fa-plus"></i> 添加步骤
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="processOwner"><i class="fas fa-user-check"></i> 流程负责人</label>
                                <input type="text" id="processOwner" placeholder="负责此流程的人员">
                            </div>
                            
                            <div class="form-group">
                                <label for="processVersion"><i class="fas fa-code-branch"></i> 版本号</label>
                                <input type="text" id="processVersion" value="1.0" placeholder="例如：1.0">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> 保存流程
                            </button>
                            <button type="button" class="btn-secondary" onclick="closeModal('addProcessModal')">
                                取消
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- 流程详情模态框 -->
        <div class="modal" id="processDetailModal">
            <div class="modal-content wide">
                <div class="modal-header">
                    <h2 id="detailTitle"></h2>
                    <button class="modal-close" onclick="closeModal('processDetailModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="process-meta" id="processMeta"></div>
                    <div class="process-description" id="processDescriptionDetail"></div>
                    <div class="process-steps" id="processStepsDetail"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal('processDetailModal')">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script src="js/process-manager.js"></script>
    <script src="js/ui.js"></script>
</body>

</html>
